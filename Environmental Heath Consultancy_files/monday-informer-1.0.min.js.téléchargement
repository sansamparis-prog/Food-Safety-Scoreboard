(()=>{"use strict";var e={269:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.generateUUID=function(){const e=()=>Math.random().toString(16).slice(2,10);return`${Date.now().toString(16)}${e()}${e()}${e()}`}},287:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ZeroToNullFields=t.ProductionUrls=t.ProductionVisitorsUrl=t.ProductionTrackUrl=t.StagingUrls=t.StagingVisitorsUrl=t.StagingTrackUrl=t.defaults=t.QUEUE_CUT_PERCENTAGES=t.QUEUE_SYNC_INTERVAL=t.QUEUE_MEMORY_CHECK_INTERVAL=t.STORAGE_MAX_SIZE_BYTES=t.QUEUE_MAX_SIZE_BYTES=t._1MB=t._1KB=t.FACEBOOK_CLICK_ID_COOKIE=t.FACEBOOK_PERSON_ID_COOKIE=t.FACEBOOK_ID_SENT=t.HUBSPOT_ID_SENT=t.LAST_SENT_NEW_SESSION=t.ALIASED_COUNT_KEY=t.ALIASED_KEY=t.PULSE_USER_ID_KEY=t.PULSE_ACCOUNT_ID_KEY=t.EXPERIMENT_VISITOR_ID_KEY=t.EXTERNAL_VISITOR_ID_KEY=t.VISITOR_ID_KEY=void 0,t.VISITOR_ID_KEY="bb_visitor_id",t.EXTERNAL_VISITOR_ID_KEY="external_visitor_id",t.EXPERIMENT_VISITOR_ID_KEY="experiment_visitor_id",t.PULSE_ACCOUNT_ID_KEY="bb_pulse_account_id",t.PULSE_USER_ID_KEY="bb_pulse_user_id",t.ALIASED_KEY="bb_visitor_aliased",t.ALIASED_COUNT_KEY="bb_visitor_aliased_count",t.LAST_SENT_NEW_SESSION="last_sent_new_session",t.HUBSPOT_ID_SENT="hubspot_id_sent",t.FACEBOOK_ID_SENT="fb_id_sent",t.FACEBOOK_PERSON_ID_COOKIE="_fbp",t.FACEBOOK_CLICK_ID_COOKIE="_fbc",t._1KB=1024,t._1MB=1024*t._1KB,t.QUEUE_MAX_SIZE_BYTES=4*t._1MB,t.STORAGE_MAX_SIZE_BYTES=t._1MB,t.QUEUE_MEMORY_CHECK_INTERVAL=2e4,t.QUEUE_SYNC_INTERVAL=2e3,t.QUEUE_CUT_PERCENTAGES=[.1,.2,.3,.4,.5,.6,.7,.8,.9],t.defaults={slug:null,sync_interval:5e3,get_visitor_id_timeout:5e3,batch_size:100,alias_timeout:5e3,methods_interval:1e3,send_immediately:!1,create_visitor:!0,cookies_enabled:!0,is_tracker_cross_domain:!1,emit_visitor_id:!1,emit_target_origin:"",bigbrain_url:"https://track.bigbrainstaging.me/stage",session_id:null,pulse_user_id:null,pulse_account_id:null,started_plan_at:null,user_created_at:null,account_created_at:null,pulse_user_serial_number:null,source:null,is_mobile_app:null},t.StagingTrackUrl="https://ei.mondaystaging.com/stage",t.StagingVisitorsUrl="https://vi.mondaystaging.com",t.StagingUrls=["https://tiles.io","//tiles.io","https://track.tiles.io/staging","//track.tiles.io/staging","https://track.bigbrainstaging.me/stage","https://track-int.bigbrainstaging.me/stage","//track-int.bigbrainstaging.me/stage","//track.bigbrainstaging.me/stage","tiles.io/staging"],t.ProductionTrackUrl="https://ei.monday.com/prod",t.ProductionVisitorsUrl="https://vi.monday.com",t.ProductionUrls=["https://bigbrain.me","https://data.bigbrain.me","//bigbrain.me","https://track.bigbrain.me/prod","https://track-int.bigbrain.me/prod","//track-int.bigbrain.me/prod","//track.bigbrain.me/prod","//data.bigbrain.me"],t.ZeroToNullFields=["pulse_user_id","pulse_account_id","started_plan_at","user_created_at","account_created_at","plan_id","pulse_user_serial_number","source"]},292:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isDevice=function(e){const t=navigator.userAgent.toLowerCase(),i={ios:/(iphone|ipod|ipad)/,android:/(android)/};try{return i[e].test(t)}catch(e){return null}},t.resolveBrowserVersion=function(e,t,i){try{const r={"internet explorer mobile":/rv:(\d+(\.\d+)?)/,"microsoft edge":/Edge\/(\d+(\.\d+)?)/,chrome:/Chrome\/(\d+(\.\d+)?)/,"chrome ios":/Chrome\/(\d+(\.\d+)?)/,safari:/Version\/(\d+(\.\d+)?)/,"mobile safari":/Version\/(\d+(\.\d+)?)/,opera:/(Opera|OPR)\/(\d+(\.\d+)?)/,firefox:/Firefox\/(\d+(\.\d+)?)/,konqueror:/Konqueror:(\d+(\.\d+)?)/,blackberry:/BlackBerry (\d+(\.\d+)?)/,android:/android\s(\d+(\.\d+)?)/,"internet explorer":/(rv:|MSIE )(\d+(\.\d+)?)/,mozilla:/rv:(\d+(\.\d+)?)/}[s(e,t,i)||""];if(void 0===r)return null;const n=e.match(r);return n?parseFloat(n[n.length-2]):null}catch(e){return null}},t.resolveBrowser=s,t.resolveOperatingSystem=function(){try{const e=navigator.userAgent;return/Windows/i.test(e)?/Phone/.test(e)||/WPDesktop/.test(e)?"Windows Phone":"windows":/(iPhone|iPad|iPod)/.test(e)?"ios":/Android/.test(e)?"android":/(BlackBerry|PlayBook|BB10)/i.test(e)?"blackberry":/Mac/i.test(e)?"mac":/Linux/.test(e)?"linux":""}catch(e){return null}},t.resolveDevice=function(){try{const e=navigator.userAgent;return/Windows Phone/i.test(e)||/WPDesktop/.test(e)?"windows phone":/iPad/.test(e)?"tablet":/iPod/.test(e)?"ipod touch":/iPhone/.test(e)?"mobile":/(BlackBerry|PlayBook|BB10)/i.test(e)?"blackberry":/Android/.test(e)?"mobile":/Mac/i.test(e)&&navigator.maxTouchPoints&&navigator.maxTouchPoints>2?"tablet":/Quest/i.test(e)?"oculus":"desktop"}catch(e){return null}},t.getReferrer=function(){const e=(0,r.getQueryParam)("utm_referrer");return e||(n(document.URL,"utm_expid")?"":document.referrer)},t.getExperimentId=function(){try{const e=(0,r.getQueryParam)("utm_expid");if(e)return e.split(".")[1]||null}catch(e){}return null},t.getTimezoneOffset=function(){try{return(new Date).getTimezoneOffset()/60*-1}catch(e){return null}},t.getNavType=function(){try{return performance.navigation.type}catch(e){return null}},t.getBrand=function(){return/https:\/\/.*monday.com.*/i.test(window.location.href)?"monday":"dapulse"},t.isSpider=function(){return/(google web preview|Page Speed Insights|baiduspider|yandexbot|YandexMobileBot|Pingdom|smtbot|bingbot|pingbot|adsbot|mediapartners|facebot|facebookexternalhit|ia_archiver|exabot|sogou|duckduckbot|googlebot|yahoo! slurp|DatadogSynthetics)/i.test(navigator.userAgent)};const r=i(755);function s(e,t,i){try{return t=t||"",i||n(e," OPR/")?n(e,"Mini")?"Opera Mini":"opera":/(BlackBerry|PlayBook|BB10)/i.test(e)?"blackberry":n(e,"IEMobile")||n(e,"WPDesktop")?"internet explorer mobile":n(e,"Edge")?"microsoft edge":n(e,"FBIOS")?"facebook mobile":n(e,"Chrome")?"chrome":n(e,"CriOS")?"chrome ios":n(t,"Apple")?n(e,"Mobile")?"Mobile Safari":"safari":n(e,"Android")?"android":n(e,"Konqueror")?"konqueror":n(e,"Firefox")?"firefox":n(e,"MSIE")||n(e,"Trident/")?"internet explorer":n(e,"Gecko")?"mozilla":""}catch(e){return null}}function n(e,t){return e.includes(t)}},370:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.cookieUtils=void 0;const r=i(398);t.cookieUtils={get(e){const t=`${e}=`,i=document.cookie.split(";").map((e=>e.trim()));for(const e of i)if(e.startsWith(t))return decodeURIComponent(e.substring(t.length));return null},set(e,t,i,s=!1,n=!1,o=!1){let a="",l="",u="";if(n||s){const e=document.location.hostname.match(/[a-z0-9][a-z0-9\\-]+\.[a-z\\.]{2,6}$/i),t=e?e[0]:"";a=t?`; domain=.${t}`:""}if(n&&(a+="; samesite=None",o=!0),i){const e=new Date;e.setTime(e.getTime()+24*i*60*60*1e3),l=`; expires=${e.toUTCString()}`}o&&(u="; secure");const _=`${e}=${encodeURIComponent(t)}${l}; path=/${a}${u}`;r.logUtils.info("Setting cookie:",_),document.cookie=_},remove(e,t=!1,i=!1){this.set(e,"",-1,t,i)},parse(e){const t=this.get(e);if(!t)return null;try{return JSON.parse(t)}catch(e){return r.logUtils.warn("Error parsing cookie:"+e),null}}},window.bb_cookie=t.cookieUtils},395:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.mergeConfig=t.initProperties=t.removeNullOrEmptyProperties=t.resolveTrackerUrls=t.addToPropertiesData=t.resolveSource=t.getInitialQueue=void 0;const r=i(287),s=i(292),n=i(398),o=i(755);t.getInitialQueue=()=>(window.BigBrainQ=window.BigBrainQ||[],window.BigBrainQ),t.resolveSource=(e,t)=>{let i=e||null;return t&&(i=(0,s.isDevice)("ios")?"mobile_app_iphone":(0,s.isDevice)("android")?"mobile_app_android":"mobile_app_unknown"),i},t.addToPropertiesData=(e,t,i)=>{e&&t&&null!=i&&(e.data=Object.assign(Object.assign({},e.data),{[t]:i}))},t.resolveTrackerUrls=e=>{const t={bigbrainTrackUrl:"",bigbrainVisitorsUrl:""};if(!e)throw new Error("BigBrain URL is required");return r.ProductionUrls.includes(e)?(t.bigbrainTrackUrl=r.ProductionTrackUrl,t.bigbrainVisitorsUrl=r.ProductionVisitorsUrl):r.StagingUrls.includes(e)?(t.bigbrainTrackUrl=r.StagingTrackUrl,t.bigbrainVisitorsUrl=r.StagingVisitorsUrl):(t.bigbrainTrackUrl=e||r.defaults.bigbrain_url||r.ProductionTrackUrl,t.bigbrainVisitorsUrl=e||r.defaults.bigbrain_url||r.ProductionVisitorsUrl),n.logUtils.info("Tracking URLs:",JSON.stringify({track:t.bigbrainTrackUrl,visitors:t.bigbrainVisitorsUrl})),t},t.removeNullOrEmptyProperties=e=>{const t=Object.assign({},e);return Object.keys(t).forEach((e=>{const i=e;null!=t[i]&&""!==t[i]||delete t[i]})),t},t.initProperties=(e,i)=>{let a=Object.assign({},e);a.os_language=navigator.language,a.user_agent=navigator.userAgent,a.browser=(0,s.resolveBrowser)(navigator.userAgent,navigator.vendor,window.opera),a.browser_version=(0,s.resolveBrowserVersion)(navigator.userAgent,navigator.vendor,window.opera),a.os=(0,s.resolveOperatingSystem)(),a.device=(0,s.resolveDevice)(),a.screen_height=screen.height,a.screen_width=screen.width,a.gcl_id=(0,o.getQueryParam)("gclid"),a.marketing_referrer=(0,s.getReferrer)(),a.marketing_banner=(0,o.getQueryParam)("utm_banner")||(0,o.getQueryParam)("marketing_banner"),a.marketing_source=(0,o.getQueryParam)("utm_source")||(0,o.getQueryParam)("marketing_source"),a.marketing_medium=(0,o.getQueryParam)("utm_medium")||(0,o.getQueryParam)("marketing_medium"),a.marketing_vertical=(0,o.getQueryParam)("utm_vertical")||(0,o.getQueryParam)("marketing_vertical"),a.marketing_content=(0,o.getQueryParam)("utm_content")||(0,o.getQueryParam)("marketing_content"),a.marketing_campaign=(0,o.getQueryParam)("utm_campaign")||(0,o.getQueryParam)("marketing_campaign"),a.marketing_adgroup=(0,o.getQueryParam)("utm_adgroup")||(0,o.getQueryParam)("marketing_adgroup"),a.marketing_retargeting=(0,o.getQueryParam)("utm_retargeting")||(0,o.getQueryParam)("marketing_retargeting"),a.marketing_language=(0,o.getQueryParam)("utm_language")||(0,o.getQueryParam)("marketing_language"),a.marketing_sub_id=(0,o.getQueryParam)("utm_sub_id")||(0,o.getQueryParam)("marketing_sub_id"),a.budget_type=(0,o.getQueryParam)("utm_bdg")||(0,o.getQueryParam)("marketing_bdg"),a.experiment_id=(0,s.getExperimentId)(),a.tz_offset=(0,s.getTimezoneOffset)(),a.nav_type=(0,s.getNavType)(),a.info3=(0,s.getBrand)(),a.gbraid=(0,o.getQueryParam)("gbraid"),a.wbraid=(0,o.getQueryParam)("wbraid"),a.source=(0,t.resolveSource)(e.source,e.is_mobile_app);const l=(0,o.getQueryParam)("utm_keyword")||(0,o.getQueryParam)("marketing_keyword");a.aw_keyword=l,(0,t.addToPropertiesData)(a,"keyword",l);const u=(0,o.getQueryParam)("fbclid")||i.facebookClickId||(0,o.getQueryParam)("gclid");(0,t.addToPropertiesData)(a,"click_id",u),(0,t.addToPropertiesData)(a,"person_id",i.facebookPersonId),(0,t.addToPropertiesData)(a,r.EXTERNAL_VISITOR_ID_KEY,(0,o.getQueryParam)("evid")),(0,t.addToPropertiesData)(a,"gsxid",(0,o.getQueryParam)("gsxid")),a.marketing_campaign&&""!==a.marketing_campaign||!a.marketing_retargeting||(a.marketing_campaign=a.marketing_retargeting);const _=(0,o.getQueryParam)("utm_campaign_id");_&&(a.marketing_campaign_id=_,a.marketing_retargeting_id=a.marketing_retargeting?_:void 0);const c=window.location.origin||`${window.location.protocol}//${window.location.hostname}${window.location.port?`:${window.location.port}`:""}`;a.marketing_landing_page=c+window.location.pathname;const d=((e,t)=>{var i,r,s,o,a,l,u,_,c,d,g,h,m;let p=null;try{window.bb_mobile_properties&&Object.keys(window.bb_mobile_properties).length>0?p=window.bb_mobile_properties:window.Android&&(p=JSON.parse(Android.getMobileProperties()))}catch(e){n.logUtils.info("Error initializing mobile properties:",e)}const v=Object.assign({},e);return p&&(v.manufacturer=p.manufacturer||null,v.app_build=p.app_build||null,v.app_version=p.app_version||null,v.device_name=p.device_name||null,v.os_version=p.os_version||null,v.is_wifi=p.is_wifi||null,v.connection_type=p.connection_type||null,v.os=null!==(i=p.os)&&void 0!==i?i:v.os,v.source=null!==(r=p.source)&&void 0!==r?r:v.source,v.device=null!==(s=p.device)&&void 0!==s?s:v.device,v.screen_width=null!==(o=p.screen_width)&&void 0!==o?o:v.screen_width,v.screen_height=null!==(a=p.screen_height)&&void 0!==a?a:v.screen_height,v.device_id=null!==(l=p.device_id)&&void 0!==l?l:v.device_id,v.visitor_id=null!==(u=p.visitor_id)&&void 0!==u?u:v.visitor_id,v.pulse_user_id=null!==(_=p.pulse_user_id)&&void 0!==_?_:v.pulse_user_id,v.pulse_account_id=null!==(c=p.pulse_account_id)&&void 0!==c?c:v.pulse_account_id,v.user_created_at=null!==(d=p.user_created_at)&&void 0!==d?d:v.user_created_at,v.account_created_at=null!==(g=p.account_created_at)&&void 0!==g?g:v.account_created_at,v.plan_id=null!==(h=p.plan_id)&&void 0!==h?h:v.plan_id,v.pulse_user_serial_number=null!==(m=p.pulse_user_serial_number)&&void 0!==m?m:v.pulse_user_serial_number,t.is_mobile_app=!0),v})(a,e);return a=Object.assign(Object.assign({},a),d),(0,t.removeNullOrEmptyProperties)(a)},t.mergeConfig=e=>{const t=(e,t)=>!r.ZeroToNullFields.includes(e)||0!==t&&"0"!==t?null!=t?t:r.defaults[e]:null,i=Object.fromEntries(Object.entries(e).map((([e,i])=>[e,t(e,i)])));return Object.assign(Object.assign({},r.defaults),i)}},398:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.logUtils=void 0;const i="[BigBrainTracker] ",r=()=>window.__ENVIRONMENT__&&"production"!==window.__ENVIRONMENT__;t.logUtils={info:(e,...t)=>{r()&&console.log(i+e,...t)},warn:(e,...t)=>{r()&&console.warn(i+e,...t)},error:(e,...t)=>{r()&&console.error(i+e,...t)}}},403:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MemoryStorage=void 0,t.isLocalStorageSupported=function(){try{const e="bb_test_localstorage";return window.localStorage.setItem(e,"test"),window.localStorage.removeItem(e),!0}catch(e){return r.logUtils.info("local storage not supported"),!1}};const r=i(398);t.MemoryStorage=class{constructor(){this.memory={}}get length(){return Object.keys(this.memory).length}clear(){this.memory={}}getItem(e){var t,i;return null!==(i=null===(t=this.memory)||void 0===t?void 0:t[e])&&void 0!==i?i:null}key(e){return Object.keys(this.memory)[e]||null}removeItem(e){delete this.memory[e]}setItem(e,t){this.memory[e]=t}}},638:(e,t)=>{function i(e,t){const i=new XMLHttpRequest;if(i.open(t.type,e),i.setRequestHeader("Content-Type",t.contentType||"application/x-www-form-urlencoded"),i.setRequestHeader("ep-tracker-name","@mondaydotcomorg/bigbrain-tracker-frontend"),i.setRequestHeader("ep-tracker-ver","0.4.4"),i.onload=()=>{var e,r,s;i.status>=200&&i.status<300?null===(e=t.success)||void 0===e||e.call(t,JSON.parse(i.responseText)):null===(r=t.error)||void 0===r||r.call(t,JSON.parse(i.responseText)),null===(s=t.complete)||void 0===s||s.call(t)},i.onerror=()=>{var e,i;null===(e=t.error)||void 0===e||e.call(t,new Error("Network Error")),null===(i=t.complete)||void 0===i||i.call(t)},t.data&&"object"==typeof t.data){const e=r(t.data);i.send(e)}else i.send(t.data);return i}function r(e,t){const i=[];for(const[s,n]of Object.entries(e)){const e=t?`${t}[${s}]`:s;null!==n&&"object"==typeof n?i.push(r(n,e)):i.push(`${encodeURIComponent(e)}=${encodeURIComponent(n)}`)}return i.join("&")}Object.defineProperty(t,"__esModule",{value:!0}),t.ajax=i,t.get=function(e,t){return i(e,{type:"GET",success:t,contentType:"application/json"})}},700:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Queue=void 0;const r=i(398),s=i(287);t.Queue=class{constructor(e,t){this.memoryQueue=[],this.needsSync=!1,this.isStorageEventProcessing=!1,this.currentSizeBytes=0,this.currentCutIndex=0,this.name=e,this.storage=t,this.initializeFromStorage(),this.updateCurrentSize(),this.startSyncInterval(),this.startMemoryCheckInterval()}get length(){return this.memoryQueue.length}get isEmpty(){return 0===this.length}get sizeInBytes(){return this.currentSizeBytes}forceSyncToStorage(){try{this.syncToStorage(),r.logUtils.info(`Force synced ${this.memoryQueue.length} items to storage`)}catch(e){r.logUtils.error("Error force syncing queue to storage",e)}}getElements(){return[...this.memoryQueue]}queue(e){null!=e?(this.memoryQueue.push(e),this.needsSync=!0):r.logUtils.warn("Attempted to queue null or undefined element")}queueBatch(e){0!==e.length&&(this.memoryQueue.push(...e),this.needsSync=!0)}dequeue(e=1){if(0===this.length)return[];const t=this.memoryQueue.splice(0,e);return this.needsSync=!0,t}dequeueAll(){return this.dequeue(this.length)}clear(){this.memoryQueue.length=0,this.currentSizeBytes=0,this.needsSync=!0}destroy(){this.syncIntervalId&&clearInterval(this.syncIntervalId),this.memoryCheckIntervalId&&clearInterval(this.memoryCheckIntervalId),window.removeEventListener("storage",this.setupStorageListener)}setupStorageListener(){window.addEventListener("storage",(e=>{if(e.key===this.name&&null!==e.newValue)try{this.isStorageEventProcessing=!0;const t=JSON.parse(e.newValue),i=e=>{var t;return null!==(t=e.uuid)&&void 0!==t?t:JSON.stringify(e)},r=new Map;[...t,...this.memoryQueue].forEach((e=>{r.set(i(e),e)})),this.memoryQueue=Array.from(r.values()),this.needsSync=!0}catch(e){const t=e instanceof Error?e.message:`Unknown error ${e}`;r.logUtils.error(`Error handling storage event: ${t}`)}finally{this.isStorageEventProcessing=!1}}))}initializeFromStorage(){try{const e=this.storage.getItem(this.name);this.memoryQueue=e?JSON.parse(e):[]}catch(e){this.memoryQueue=[];const t=e instanceof Error?e.message:`Unknown error ${e}`;r.logUtils.error(`Error initializing queue from storage: ${t}`)}}updateCurrentSize(){this.currentSizeBytes=this.calculateJsonSize(this.memoryQueue)}startMemoryCheckInterval(){this.memoryCheckIntervalId=setInterval((()=>{this.updateCurrentSize(),this.currentSizeBytes>s.QUEUE_MAX_SIZE_BYTES?(r.logUtils.warn(`Memory limit exceeded. Current size: ${this.currentSizeBytes} bytes`),this.enforceMemoryLimit()):this.currentCutIndex=0}),s.QUEUE_MEMORY_CHECK_INTERVAL)}enforceMemoryLimit(){if(0===this.memoryQueue.length)return;const e=s.QUEUE_CUT_PERCENTAGES[this.currentCutIndex],t=Math.ceil(this.memoryQueue.length*e);this.dequeue(t),this.updateCurrentSize(),r.logUtils.warn(`Memory limit exceeded. Removed ${t} items (${100*e}% of queue)`),this.currentSizeBytes>s.QUEUE_MAX_SIZE_BYTES&&this.currentCutIndex<s.QUEUE_CUT_PERCENTAGES.length-1&&(this.currentCutIndex++,r.logUtils.warn(`Still over memory limit. Next cut will remove ${100*s.QUEUE_CUT_PERCENTAGES[this.currentCutIndex]}% of queue`))}startSyncInterval(){this.syncIntervalId=setInterval((()=>{this.needsSync&&!this.isStorageEventProcessing&&this.syncToStorage()}),s.QUEUE_SYNC_INTERVAL)}syncToStorage(){try{const e=this.getLatestEventsPayload();this.storage.setItem(this.name,JSON.stringify(e)),this.needsSync=!1}catch(e){const t=e instanceof Error?e.message:`Unknown error ${e}`;r.logUtils.error(`Error syncing queue to storage: ${t}`)}}getLatestEventsPayload(){if(0===this.memoryQueue.length)return[];let e=2,t=this.memoryQueue.length;for(let i=this.memoryQueue.length-1;i>=0;i--){const r=this.memoryQueue[i],n=this.calculateJsonSize(r);if(e+n>s.STORAGE_MAX_SIZE_BYTES)break;t=i,e+=n+1}return this.memoryQueue.slice(t)}calculateJsonSize(e){return(new TextEncoder).encode(JSON.stringify(e)).length}}},755:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getQueryParam=function(e){try{const t=new URLSearchParams(window.location.search).get(e);return null!==t?decodeURIComponent(t.replace(/\+/g," ")):null}catch(e){return null}}}},t={};function i(r){var s=t[r];if(void 0!==s)return s.exports;var n=t[r]={exports:{}};return e[r](n,n.exports,i),n.exports}var r={};(()=>{r.BigBrainTracker=function(e={}){l.logUtils.info("BigBrainTracker function called with options:",e);const t=new c(e),i=(...e)=>{if(0===e.length)return void l.logUtils.error("No action specified for BigBrainTracker.");const i=e[0];"function"!=typeof t[i]||i.startsWith("_")?l.logUtils.error(`Unsupported action: ${String(i)}`):t[i](...e.slice(1))},r=Object.getOwnPropertyNames(c.prototype).filter((e=>"constructor"!==e&&!e.startsWith("_")));for(const e of r)i[e]=t[e].bind(t);return Object.keys(t).forEach((e=>{e.startsWith("_")||Object.defineProperty(i,e,{get:()=>t[e],set:i=>{t[e]=i},enumerable:!0})})),i};const e=i(370),t=i(700),s=i(403),n=i(638),o=i(287),a=i(292),l=i(398),u=i(269),_=i(395);class c{constructor(e={}){this.config={},this.storage=(0,s.isLocalStorageSupported)()?window.localStorage:new s.MemoryStorage,this.eventsQueue=new t.Queue("_event_tracker_queue",this.storage),this.bigbrainTrackUrl="",this.bigbrainVisitorsUrl="",this.sending=!1,this.send_immediately=!1,this.aliased=!1,this.aliasedCount=0,this.visitor_id=null,this.cookieExpireDay=3650,this.experiment_visitor_id=null,this.eventProps={},this.time_diff=null,this.isFlushingEventsOnUnload=!1;try{if(this.config=(0,_.mergeConfig)(e),(0,a.isSpider)())return void l.logUtils.warn("Visitor creation skipped: detected as spider.");const t=(0,_.resolveTrackerUrls)(this.config.bigbrain_url);this.bigbrainTrackUrl=t.bigbrainTrackUrl,this.bigbrainVisitorsUrl=t.bigbrainVisitorsUrl,this.aliased=null!==this._getCookie(o.ALIASED_KEY);const i=this._getCookie(o.ALIASED_COUNT_KEY);this.aliasedCount=null!==i?Number(i):0,this.visitor_id=null,this.experiment_visitor_id=null,this.eventProps=(0,_.initProperties)(this.config,{facebookClickId:this._getCookie(o.FACEBOOK_CLICK_ID_COOKIE),facebookPersonId:this._getCookie(o.FACEBOOK_PERSON_ID_COOKIE)}),this.eventProps.visitor_id&&(this.visitor_id=this.eventProps.visitor_id),this.eventProps.pulse_user_id&&(this.config.pulse_user_id=this.eventProps.pulse_user_id),this._setExternalVisitorIdCookie(),this._initTimeDiff(),this._initIds(),this.processPreQueuedEvents(),null!=this.config.send_immediately&&(this.send_immediately=this.config.send_immediately),(0,s.isLocalStorageSupported)()||(this.send_immediately=!0,this.track("local_storage_not_supported")),this.config.cookies_enabled&&(this._sendHubspotId(),this._sendFacebookId()),this._scheduleEventSending(),this._execute(),this._setupUnloadHandler(),this.track=this.track.bind(this),this.track_many=this.track_many.bind(this),l.logUtils.info("BigBrainTracker initialized",JSON.stringify(Object.assign(Object.assign({},this.config),this.eventProps)))}catch(e){l.logUtils.error("BigBrainTracker failed to initialized, error:",e)}}sendAll(){try{if(this.sending||this._hasNoIds())return;this._sendEvents(this.eventsQueue.getElements())}catch(e){l.logUtils.error("Error sending all events:",e)}}set_account_id(e){this.config.pulse_account_id=e}set_user_id(e){this.config.pulse_user_id=e,null!=this.config.pulse_user_id&&(null!==this.visitor_id?this.aliased||this._alias():setTimeout((()=>{this.set_user_id(e)}),this.config.methods_interval))}set_utm_cluster_id(e){null!==this.visitor_id?this._update_visitor_utm_cluster_id(e):setTimeout((()=>{this.set_utm_cluster_id(e)}),this.config.methods_interval)}set_utm_locale_id(e){null!==this.visitor_id?this._update_visitor_utm_locale_id(e):setTimeout((()=>{this.set_utm_locale_id(e)}),this.config.methods_interval)}track(e,t={}){if(this._shouldSkipEvent(e))return;this._processEventData(e,t);const i=this._mergeEventParams(t);this.eventsQueue.queue(i),this.send_immediately&&this.sendAll()}track_many(e){const t=[];for(const[i,r]of e)this._shouldSkipEvent(i)||(this._processEventData(i,r),t.push(this._mergeEventParams(r)));t.length>0&&this.eventsQueue.queueBatch(t),this.send_immediately&&this.sendAll()}processPreQueuedEvents(){const e=(0,_.getInitialQueue)();for(let t=0,i=e.length;t<i;t++){const i=e[t];this._execute(...i)}}_execute(...e){var t;try{if(0===e.length||"_"===(null===(t=e[0])||void 0===t?void 0:t.charAt(0)))return;const i=e[0];if("function"!=typeof this[i])return void l.logUtils.error(`unsupported action: ${String(i)}`);const r=e.slice(1);this[i].apply(this,r)}catch(e){l.logUtils.error("Error executing:",e)}}_initIds(){null==this.visitor_id&&(this.visitor_id=this._getCookie(o.VISITOR_ID_KEY),null!=this.visitor_id&&(this._fireTagManagerVisitorReady(),this._emitVisitorId())),this._shouldCreateVisitorId()?(this.experiment_visitor_id=this._getCookie(o.EXPERIMENT_VISITOR_ID_KEY),this._createVisitorId()):this._shouldLinkVisitorToUser()&&this._alias()}_shouldCreateVisitorId(){return this._hasNoVisitorId()&&this.config.create_visitor&&this.config.cookies_enabled}_shouldLinkVisitorToUser(){return null!=this.visitor_id&&null!=this.config.pulse_user_id&&this.aliasedCount<2&&this.config.cookies_enabled}_createVisitorId(){if(this._hasNoVisitorId()){const e=Object.assign(Object.assign({},this.eventProps),{xi_time_diff:this.time_diff,experiment_visitor_id:this.experiment_visitor_id});(0,n.ajax)(`${this.bigbrainVisitorsUrl}/api/create`,{type:"POST",data:JSON.stringify(e),contentType:"application/json",success:e=>{this._handleVisitorIdCreationSuccess(e)},error:e=>{l.logUtils.error("Error creating visitor id, error:",e),setTimeout((()=>this._createVisitorId()),this.config.get_visitor_id_timeout)}})}}_handleVisitorIdCreationSuccess(e){l.logUtils.info("Visitor id created successfully:",JSON.stringify(e)),this.visitor_id=e.visitor_id||null,this.visitor_id&&(this._setCookie(o.VISITOR_ID_KEY,this.visitor_id),this._fireTagManagerVisitorReady(),this._fireNewVisitEvent(),this.sendAll(),null!=this.config.pulse_user_id&&this._alias(),this._emitVisitorId())}_alias(){this.config.cookies_enabled&&null!==this.config.pulse_user_id&&void 0!==this.config.pulse_user_id&&""!==this.config.pulse_user_id&&"0"!==this.config.pulse_user_id&&(0,n.ajax)(`${this.bigbrainVisitorsUrl}/api/link_visitor_to_user`,{type:"POST",data:JSON.stringify({visitor:{visitor_id:this.visitor_id,pulse_user_id:this.config.pulse_user_id}}),contentType:"application/json",success:()=>{this.aliased=!0,this._setCookie(o.ALIASED_KEY,"true"),this.aliasedCount+=1,this._setCookie(o.ALIASED_COUNT_KEY,this.aliasedCount.toString())},error:()=>{setTimeout((()=>this._alias()),this.config.alias_timeout)}})}_sendEvents(e){if(this._hasNoIds()||0===e.length||this.sending)return;const t=[],i=[];for(const r of e){if(this.config.batch_size&&i.length>=this.config.batch_size)break;if(r.uuid&&!t.includes(r.uuid)){t.push(r.uuid);const e=Math.floor(Date.now()/1e3);null!==r.timestamp&&void 0!==r.timestamp?r.seconds_since_happened=e-r.timestamp:null===r.timestamp?r.seconds_since_happened=e:void 0===r.timestamp&&(r.seconds_since_happened=NaN),r.pulse_account_id=this._getDefaultIfEmpty(r.pulse_account_id,this.config.pulse_account_id),r.pulse_user_id=this._getDefaultIfEmpty(r.pulse_user_id,this.config.pulse_user_id),r.visitor_id=this._getDefaultIfEmpty(r.visitor_id,this.visitor_id),r.source=this._getDefaultIfEmpty(r.source,this.eventProps.source),i.push(r)}}this.sending=!0;try{(0,n.ajax)(`${this.bigbrainTrackUrl}/event`,{type:"POST",data:JSON.stringify(i),contentType:"application/json",success:()=>{this._filterSentEventsFromQueue(t),this.sending=!1,this.send_immediately&&this.sendAll()},complete:()=>{this.sending=!1,setTimeout((()=>this._scheduleEventSending()),this.config.sync_interval)}})}catch(e){l.logUtils.error("Error sending events:",e),this.sending=!1,setTimeout((()=>this._scheduleEventSending()),this.config.sync_interval)}}_getDefaultIfEmpty(e,t){return null==e||""===e?t:e}_filterSentEventsFromQueue(e){const t=this.eventsQueue.dequeueAll().filter((t=>!e.includes(t.uuid)));t.length>0&&this.eventsQueue.queueBatch(t)}_scheduleEventSending(){try{if(this.sending)return;this.eventsQueue.getElements().length>0?this.sendAll():setTimeout((()=>this._scheduleEventSending()),this.config.sync_interval)}catch(e){l.logUtils.error("Error scheduling event sending:",e)}}_hasNoIds(){return null==this.visitor_id&&null==this.config.pulse_user_id}_fireNewVisitEvent(){this.track("bb_new_device",{data:{screen_width:this.eventProps.screen_width,screen_height:this.eventProps.screen_height}})}_fireTagManagerVisitorReady(){window.dataLayer=window.dataLayer||[],window.dataLayer.push({bbVisitorId:this.visitor_id}),window.dataLayer.push({event:"bbTrackerVisitorReady"})}_emitVisitorId(){if(this.config.emit_visitor_id)try{window.parent.postMessage({type:"bb_tracker_message",bb_visitor_id:this.visitor_id},this.config.emit_target_origin||window.parent.location.origin)}catch(e){l.logUtils.error("Failed to post message:",e)}}_sendFacebookId(){try{if(this._getCookie(o.FACEBOOK_ID_SENT))return;let e=200;const t=setInterval((()=>{const i=this._getCookie(o.FACEBOOK_PERSON_ID_COOKIE),r=this._getCookie(o.FACEBOOK_CLICK_ID_COOKIE);i&&(this.track("facebook_id_tracking",{info1:i,info2:r,info3:e}),this._update_visitor_person_id(i,r),this._setCookie(o.FACEBOOK_ID_SENT,"true"),clearInterval(t)),e--,0===e&&clearInterval(t)}),1e3)}catch(e){l.logUtils.error("Error sending Facebook ID:",e)}}_update_visitor_person_id(e,t){const i={person_id:e};t&&(i.click_id=t),(0,n.ajax)(`${this.bigbrainVisitorsUrl}/api/update`,{type:"PUT",data:JSON.stringify({visitor_id:this.visitor_id,data:i}),contentType:"application/json",success:()=>{}})}_sendHubspotId(){try{if(this._getCookie(o.HUBSPOT_ID_SENT))return;let e=100;const t=setInterval((()=>{const i=this._getCookie("hubspotutk");i&&(this.track("hubspot_tracking",{info1:i}),this._setCookie(o.HUBSPOT_ID_SENT,"true"),clearInterval(t)),e--,0===e&&clearInterval(t)}),500)}catch(e){l.logUtils.error("Error sending HubSpot ID:",e)}}_setExternalVisitorIdCookie(){var e,t;const i=null===(t=null===(e=this.eventProps)||void 0===e?void 0:e.data)||void 0===t?void 0:t[o.EXTERNAL_VISITOR_ID_KEY];i&&this._setCookie(o.EXTERNAL_VISITOR_ID_KEY,i)}_hasNoVisitorId(){return null==this.visitor_id}_getCookie(t){return this.config.cookies_enabled?e.cookieUtils.get(t):null}_setCookie(t,i,r){if(!this.config.cookies_enabled)return;const s=null!=r?r:this.cookieExpireDay;this.config.is_tracker_cross_domain?e.cookieUtils.set(t,i,s,!1,!0):e.cookieUtils.set(t,i,s,!0)}_removeCookie(t){this.config.cookies_enabled&&e.cookieUtils.remove(t)}_shouldSkipEvent(e){if("new_session"===e){const e=this.storage.getItem(o.LAST_SENT_NEW_SESSION),t=Math.floor(Date.now()/1e3);if(this.storage.setItem(o.LAST_SENT_NEW_SESSION,t.toString()),e&&t-parseInt(e,10)<1800)return!0}return!1}_processEventData(e,t){t.name=e,t.timestamp=Math.floor(Date.now()/1e3),t.uuid=(0,u.generateUUID)(),this._add_fullStory_to_data_properties(),this._raise_js_event(e,t)}_add_fullStory_to_data_properties(){var e,t;try{const i=null!==(e=window.FSSessionUrl)&&void 0!==e?e:null,r=null!==(t=window.FSSessionStartedAt)&&void 0!==t?t:null;return!!i&&((0,_.addToPropertiesData)(this.eventProps,"fs_session_url",i),(0,_.addToPropertiesData)(this.eventProps,"fs_session_started_at",r),!0)}catch(e){return l.logUtils.error("Error adding FullStory data to eventProps:",e),!1}}_raise_js_event(e,t={}){try{window.dispatchEvent(new CustomEvent("bigbrain-track-event",{detail:{name:e,data:t}}))}catch(e){l.logUtils.error("Error raising JS event:",e)}}_update_visitor_utm_cluster_id(e){(0,n.ajax)(`${this.bigbrainVisitorsUrl}/api/update`,{type:"PUT",data:JSON.stringify({visitor_id:this.visitor_id,utm_cluster_id:e}),contentType:"application/json",success:()=>{}})}_update_visitor_utm_locale_id(e){(0,n.ajax)(`${this.bigbrainVisitorsUrl}/api/update`,{type:"PUT",data:JSON.stringify({visitor_id:this.visitor_id,utm_locale_id:e}),contentType:"application/json",success:()=>{}})}_mergeEventParams(e){const t={pulse_account_id:this.eventProps.pulse_account_id,pulse_user_id:this.eventProps.pulse_user_id,visitor_id:this.visitor_id,started_plan_at:this.eventProps.started_plan_at,user_created_at:this.eventProps.user_created_at,account_created_at:this.eventProps.account_created_at,plan_id:this.eventProps.plan_id,pulse_user_serial_number:this.eventProps.pulse_user_serial_number,source:this.eventProps.source},i=Object.assign(Object.assign(Object.assign(Object.assign({},t),this.eventProps),e),{data:Object.assign(Object.assign({},this.eventProps.data||{}),e.data||{})});return Object.fromEntries(Object.entries(i).filter((([e,t])=>null!=t&&""!==t)))}_initTimeDiff(){const e=(new Date).getTimezoneOffset()/60*-1;this.time_diff=e>0?`+${e}`:`${e}`}_setupUnloadHandler(){try{const e=()=>{this.isFlushingEventsOnUnload||(this.isFlushingEventsOnUnload=!0,this.eventsQueue.isEmpty||(this.eventsQueue.forceSyncToStorage(),l.logUtils.info(`Flushed ${this.eventsQueue.length} events to localStorage during page unload`)))};window.addEventListener("beforeunload",e)}catch(e){l.logUtils.error("Error setting up unload handler:",e)}}}})(),window.BigBrainTracker=r.BigBrainTracker})();